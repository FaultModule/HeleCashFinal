<!DOCTYPE html>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Receitas - HeleCash</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-4">
  <nav class="bg-gray-800 text-white p-4 rounded-lg mb-4 flex justify-between items-center">
  <div class="text-xl font-bold">HeleCash</div>
  <div class="space-x-4">
    <a href="index.html" class="hover:underline">Dashboard</a>
    <a href="receitas.html" class="hover:underline">Receitas</a>
    <a href="despesas.html" class="hover:underline">Despesas</a>
  </div>
</nav>
  <div class="max-w-5xl mx-auto bg-white rounded-xl shadow p-6">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold text-green-700">üí∏ Receitas</h1>
      <button id="logout-btn" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Sair</button>
    </div>

    <div class="overflow-x-auto">
      <table class="min-w-full text-sm text-left text-gray-700">
        <thead class="bg-green-100 text-green-800">
          <tr>
            <th class="px-4 py-2">Descri√ß√£o</th>
            <th class="px-4 py-2">Categoria</th>
            <th class="px-4 py-2">Data</th>
            <th class="px-4 py-2">Valor</th>
          </tr>
        </thead>
        <tbody id="receitas-list" class="divide-y divide-gray-200">
        </tbody>
      </table>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
  const token = localStorage.getItem('token');
  if (!token) {
    window.location.href = 'login.html';
    return;
  }

  document.getElementById('logout-btn').addEventListener('click', () => {
    localStorage.removeItem('token');
    window.location.href = 'login.html';
  });

  const currentPage = window.location.pathname.includes('receitas') ? 'receita' : 'despesa';
  const monthSelect = document.getElementById('filter-month');
  const yearSelect = document.getElementById('filter-year');

  document.getElementById('filter-btn').addEventListener('click', () => {
    fetchTransactions(token, currentPage);
  });

  // Preencher os selects de m√™s e ano
  const now = new Date();
  for (let m = 0; m < 12; m++) {
    const option = document.createElement('option');
    option.value = m;
    option.textContent = new Date(0, m).toLocaleString('pt-BR', { month: 'long' });
    if (m === now.getMonth()) option.selected = true;
    monthSelect.appendChild(option);
  }
  const currentYear = now.getFullYear();
  for (let y = currentYear; y >= currentYear - 5; y--) {
    const option = document.createElement('option');
    option.value = y;
    option.textContent = y;
    if (y === currentYear) option.selected = true;
    yearSelect.appendChild(option);
  }

  fetchTransactions(token, currentPage);
});

async function fetchTransactions(token, tipo) {
  try {
    const month = document.getElementById('filter-month').value;
    const year = document.getElementById('filter-year').value;

    const response = await fetch('https://helecashfinal.onrender.com/api/lancamentos', {
      headers: { 'Authorization': `Bearer ${token}` }
    });

    const data = await response.json();
    const filtered = data.filter(item => {
      const d = new Date(item.data);
      return (
        item.categoria_tipo === tipo &&
        d.getMonth() == month &&
        d.getFullYear() == year
      );
    });

    const list = document.getElementById('transaction-list');
    list.innerHTML = '';

    filtered.forEach(item => {
      const li = document.createElement('li');
      li.classList.add('flex', 'justify-between', 'items-center', 'border-b', 'py-2');

      const text = document.createElement('span');
      text.textContent = `${item.data.split('T')[0]} - ${item.descricao} - R$ ${Number(item.valor).toFixed(2)} (${item.categoria_nome})`;

      const actions = document.createElement('div');
      actions.classList.add('space-x-2');

      const editBtn = document.createElement('button');
      editBtn.textContent = 'Editar';
      editBtn.classList.add('text-blue-500', 'hover:underline');
      // editBtn.onclick = () => editarLancamento(item);

      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'Excluir';
      deleteBtn.classList.add('text-red-500', 'hover:underline');
      deleteBtn.onclick = () => excluirLancamento(item.id);

      actions.appendChild(editBtn);
      actions.appendChild(deleteBtn);

      li.appendChild(text);
      li.appendChild(actions);

      list.appendChild(li);
    });
  } catch (error) {
    console.error('Erro ao buscar lan√ßamentos:', error);
  }
}

async function excluirLancamento(id) {
  const token = localStorage.getItem('token');
  if (!confirm('Tem certeza que deseja excluir este lan√ßamento?')) return;

  try {
    const response = await fetch(`https://helecashfinal.onrender.com/api/lancamentos/${id}`, {
      method: 'DELETE',
      headers: { 'Authorization': `Bearer ${token}` }
    });

    const result = await response.json();
    alert(result.message || 'Lan√ßamento exclu√≠do');
    location.reload();
  } catch (error) {
    console.error('Erro ao excluir lan√ßamento:', error);
  }
}

  </script>

  <script src="receitas.js"></script>
</body>
</html>

